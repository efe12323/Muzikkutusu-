<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MÃ¼zik Kutusu</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  background:#0f0f0f;
  color:white;
}
.spotify-green{background:#1DB954;}
.spotify-text{color:#1DB954}
.drawer{
  height:85vh;
  bottom:-100%;
  transition:0.4s ease;
}
.drawer.active{
  bottom:0;
}
.card:hover{transform:scale(1.03)}
</style>
</head>

<body class="min-h-screen pb-40">

<header class="flex justify-between items-center p-5 border-b border-zinc-800 bg-black">
  <div>
    <h1 class="text-2xl font-bold spotify-text">ğŸµ MÃ¼zik Kutusu</h1>
    <p class="text-sm text-zinc-400">TÃ¼rkiyeâ€™nin %100 Ã¼cretsiz telifsiz mÃ¼zik platformu</p>
  </div>
  <button onclick="openAdminLogin()" class="px-4 py-1 text-sm rounded-full border border-zinc-700 hover:bg-zinc-900">Admin</button>
</header>

<section class="p-4 flex gap-3 flex-wrap">
  <input id="searchInput" onkeyup="loadMusics()" type="text" placeholder="MÃ¼zik ara..."
  class="w-full md:w-1/3 bg-zinc-900 px-4 py-2 rounded-lg outline-none">

  <select id="filterSelect" onchange="loadMusics()"
  class="bg-zinc-900 px-4 py-2 rounded-lg">
    <option value="">TÃ¼mÃ¼</option>
    <option>Rap</option>
    <option>Chill</option>
    <option>Rock</option>
    <option>Anadolu Rock</option>
    <option>Lo-fi</option>
  </select>
</section>

<main class="p-6 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6" id="musicList"></main>

<!-- PLAYER -->
<div id="player" class="fixed bottom-0 left-0 w-full bg-black border-t border-zinc-800 p-4 hidden">
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-3">
      <img id="playerCover" class="w-14 h-14 rounded">
      <div>
        <h3 id="playerTitle"></h3>
        <p id="playerTags" class="text-xs text-gray-400"></p>
      </div>
    </div>

    <div class="flex items-center gap-6 text-xl">
      <button onclick="prevMusic()">â®ï¸</button>
      <button onclick="togglePlay()">â¯ï¸</button>
      <button onclick="nextMusic()">â­ï¸</button>
      <a id="downloadBtn" class="spotify-text" download>â¬‡</a>
    </div>
  </div>
</div>

<!-- ADMIN LOGIN -->
<div id="adminLoginModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center">
  <div class="bg-zinc-900 p-6 rounded-xl w-80">
    <h2 class="text-lg mb-4">ğŸ” Admin GiriÅŸ</h2>
    <input id="adminPassInput" type="password" placeholder="Åifre" class="w-full p-2 bg-black rounded mb-3">
    <button onclick="checkAdmin()" class="spotify-green w-full py-2 rounded">GiriÅŸ</button>
  </div>
</div>

<!-- ADMIN DRAWER -->
<div id="adminPanel" class="drawer fixed left-0 bg-zinc-950 border-t border-zinc-800 w-full overflow-y-auto p-5">

  <div class="max-w-5xl mx-auto">

    <div class="flex justify-between mb-4">
      <h2 class="text-xl spotify-text">ğŸ§ MÃ¼zik YÃ¼kleme Paneli</h2>
      <button onclick="closeAdminPanel()" class="text-red-500">Kapat âœ–</button>
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <input id="newTitle" placeholder="MÃ¼zik BaÅŸlÄ±ÄŸÄ±" class="p-2 rounded bg-black">
      <input id="newTags" placeholder="Etiketler (Ã¶rn: Rap, Chill)" class="p-2 rounded bg-black">
    </div>

    <div class="grid md:grid-cols-2 gap-4 mt-3">

      <!-- AUDIO -->
      <label class="bg-black p-4 rounded flex flex-col items-center justify-center cursor-pointer border border-dashed border-zinc-600">
        <span>ğŸµ MP3 SeÃ§</span>
        <input type="file" id="newAudio" accept=".mp3,.wav,.ogg,.m4a" hidden
        onchange="audioLabel.innerText=this.files[0].name || 'SeÃ§ildi'">
        <small id="audioLabel" class="text-xs opacity-60 mt-1">HenÃ¼z seÃ§ilmedi</small>
      </label>

      <!-- COVER -->
      <label class="bg-black p-4 rounded flex flex-col items-center justify-center cursor-pointer border border-dashed border-zinc-600">
        <span>ğŸ–¼ï¸ Kapak SeÃ§</span>
        <input type="file" id="newCover" accept="image/*" hidden
        onchange="coverLabel.innerText=this.files[0].name || 'SeÃ§ildi'">
        <small id="coverLabel" class="text-xs opacity-60 mt-1">HenÃ¼z seÃ§ilmedi</small>
      </label>
    </div>

    <button onclick="uploadMusic()" class="spotify-green w-full py-3 rounded mt-4 font-bold">
      ğŸš€ MÃœZÄ°ÄÄ° YÃœKLE
    </button>

    <h3 class="mt-10 mb-3 text-lg">ğŸ¼ YÃ¼klÃ¼ MÃ¼zikler</h3>
    <div id="adminMusicList" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>

  </div>
</div>

<audio id="audio"></audio>

<script>
const supabase = supabase.createClient(
  "https://jzidtvylnrolmmlaegyr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6aWR0dnlsbnJvbG1tbGFlZ3lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMDQ4ODgsImV4cCI6MjA4MDU4MDg4OH0.S61VHALTStNxq2RY4B2GhrAuELTtgycsTrTw5cH04EA"
);

let musicData=[]
let currentIndex=0

function openAdminLogin(){
  adminLoginModal.classList.remove("hidden")
}

function checkAdmin(){
  if(adminPassInput.value==="efe12345efe"){
    adminLoginModal.classList.add("hidden")
    adminPanel.classList.add("active")
    loadMusics()
  } else alert("Åifre yanlÄ±ÅŸ!")
}

function closeAdminPanel(){
 adminPanel.classList.remove("active")
}

async function uploadMusic(){
 const audioFile = newAudio.files[0]
 const coverFile = newCover.files[0]

 if(!audioFile || !coverFile) return alert("MP3 ve Kapak seÃ§!")

 let audioName = Date.now()+"_"+audioFile.name
 let coverName = Date.now()+"_"+coverFile.name

 await supabase.storage.from("music").upload(audioName,audioFile)
 await supabase.storage.from("music").upload(coverName,coverFile)

 const audioURL = supabase.storage.from("music").getPublicUrl(audioName).data.publicUrl
 const coverURL = supabase.storage.from("music").getPublicUrl(coverName).data.publicUrl

 await supabase.from("musics").insert({
   title:newTitle.value,
   tags:newTags.value,
   audio_url:audioURL,
   cover_url:coverURL
 })

 alert("âœ… YÃ¼klendi")
 newTitle.value=""
 newTags.value=""
 audioLabel.innerText="HenÃ¼z seÃ§ilmedi"
 coverLabel.innerText="HenÃ¼z seÃ§ilmedi"
 loadMusics()
}

async function loadMusics(){
 let {data} = await supabase.from("musics").select("*").order("created_at",{ascending:false})

 if(!data) return
 musicData=data

 musicList.innerHTML=""
 adminMusicList.innerHTML=""

 data.forEach((m,i)=>{

  musicList.innerHTML+=`
  <div onclick="playMusic(${i})" class="card bg-zinc-900 p-3 rounded-xl cursor-pointer transition">
   <img src="${m.cover_url}" class="rounded w-full aspect-square">
   <h3 class="mt-2">${m.title}</h3>
   <p class="text-xs text-gray-400">${m.tags}</p>
  </div>`

  adminMusicList.innerHTML+=`
   <div class="bg-black p-2 rounded">
     <h3 class="text-sm truncate">${m.title}</h3>
     <button onclick="deleteMusic('${m.id}','${m.audio_url}','${m.cover_url}')" class="text-red-500 text-xs mt-1">Sil</button>
   </div>`
 })
}

function playMusic(index){
 currentIndex=index
 let m = musicData[index]
 player.classList.remove("hidden")
 audio.src=m.audio_url
 audio.play()
 playerTitle.innerText=m.title
 playerTags.innerText=m.tags
 playerCover.src=m.cover_url
 downloadBtn.href=m.audio_url
}

function togglePlay(){ audio.paused?audio.play():audio.pause() }
function nextMusic(){ if(currentIndex<musicData.length-1)playMusic(currentIndex+1)}
function prevMusic(){ if(currentIndex>0)playMusic(currentIndex-1)}

async function deleteMusic(id,audioURL,coverURL){
 await supabase.storage.from("music")
 .remove([audioURL.split('/').pop(), coverURL.split('/').pop()])
 await supabase.from("musics").delete().eq("id",id)
 loadMusics()
}

loadMusics()
</script>
</body>
  </html>
