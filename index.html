<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√ºzik Kutusu</title>

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#1DB954',
        dark: '#0B0B0B',
        card: '#161616'
      }
    }
  }
}
</script>
</head>

<body class="bg-dark text-white">

<!-- HEADER -->
<div class="p-5 flex flex-col md:flex-row justify-between items-center gap-4 bg-black/80 backdrop-blur shadow-lg sticky top-0 z-50">
  <div class="flex items-center gap-2">
    <h1 class="text-3xl font-extrabold text-primary tracking-wide">üéß M√ºzik Kutusu</h1>
  </div>
  <p class="text-sm text-gray-400">%100 √úcretsiz ‚Ä¢ Telifsiz m√ºzik platformu</p>

  <div class="flex gap-2">
    <input id="search" oninput="renderMusics()" placeholder="Ara..."
      class="bg-neutral-800 px-4 py-2 rounded-xl outline-none">
    <select id="filter" onchange="renderMusics()"
      class="bg-neutral-800 px-4 py-2 rounded-xl">
      <option value="all">T√ºm√º</option>
      <option>Rap</option>
      <option>Pop</option>
      <option>Rock</option>
      <option>Anadolu Rock</option>
      <option>Chill</option>
      <option>Jazz</option>
      <option>Lo-Fi</option>
      <option>Electronic</option>
    </select>
  </div>
</div>

<!-- M√úZƒ∞KLER -->
<div id="musicList" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6 p-6 pb-40"></div>

<!-- PLAYER -->
<div id="player"
  class="hidden fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-lg p-4 flex justify-between items-center border-t border-neutral-700">

  <div class="flex items-center gap-3">
    <img id="playerCover" class="w-14 h-14 rounded-lg object-cover">
    <p id="playerTitle" class="font-semibold"></p>
  </div>

  <div class="flex gap-6 text-2xl items-center">
    <button onclick="prevMusic()">‚èÆ</button>
    <button id="playPause" onclick="togglePlay()">‚ñ∂</button>
    <button onclick="nextMusic()">‚è≠</button>
    <a id="downloadBtn" download class="text-primary">‚¨á</a>
  </div>
</div>

<!-- ADMIN BUTTON -->
<button onclick="openAdminModal()"
class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-primary text-black px-6 py-3 font-bold rounded-full shadow-xl hover:scale-105 transition">
  Admin Panel
</button>

<!-- ADMIN MODAL -->
<div id="adminModal" class="hidden fixed inset-0 bg-black/70 flex justify-center items-center z-50">
  <div class="bg-card p-6 rounded-xl w-full max-w-xl">

    <h2 class="text-xl font-bold text-primary mb-4">Admin Panel</h2>

    <div id="adminLogin">
      <input id="adminPass" type="password" placeholder="≈ûifre"
      class="w-full p-3 bg-neutral-800 rounded mb-3">
      <button onclick="checkAdmin()"
      class="w-full bg-primary text-black py-2 font-bold rounded">
        Giri≈ü Yap
      </button>
    </div>

    <div id="adminPanel" class="hidden">

      <input id="musicTitle" placeholder="M√ºzik Ba≈ülƒ±ƒüƒ±"
      class="w-full p-2 mb-2 bg-neutral-800 rounded">

      <input id="musicTags" placeholder="Etiketler"
      class="w-full p-2 mb-2 bg-neutral-800 rounded">

      <input id="musicCover" type="file" accept="image/*"
      class="mb-3 w-full">

      <input id="musicFile" type="file" accept="audio/*"
      class="mb-4 w-full">

      <button onclick="uploadMusic()"
      class="w-full bg-primary text-black py-2 rounded font-bold">
        M√ºzik Y√ºkle
      </button>

      <p id="status" class="text-center text-sm mt-2"></p>

      <div id="adminMusicList" class="mt-6 space-y-3"></div>

      <button onclick="closeAdminModal()"
      class="mt-6 w-full bg-neutral-800 py-2 rounded">
        Kapat
      </button>

    </div>
  </div>
</div>

<script>
const CLOUD_NAME = "dq4iighak";
const UPLOAD_PRESET = "music_upload";
const ADMIN_PASS = "efe12345efe";
const JSON_FILE = "music_list.json";

let musics = [];
let audio = new Audio();
let currentIndex = 0;

function cloudUrl(name){
  return `https://res.cloudinary.com/${CLOUD_NAME}/raw/upload/${name}`;
}

async function loadMusics(){
  try {
    const res = await fetch(cloudUrl(JSON_FILE));
    musics = await res.json();
  } catch {
    musics = [];
  }
  renderMusics();
}

async function saveMusics(){
  const blob = new Blob([JSON.stringify(musics)], { type: 'application/json' });
  const data = new FormData();
  data.append("file", blob);
  data.append("upload_preset", UPLOAD_PRESET);
  data.append("public_id", "music_list");
  data.append("overwrite", "true");

  await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/raw/upload`, { 
    method: "POST", body: data
  });
}

function uploadToCloudinary(file, type){
  const data = new FormData();
  data.append("file", file);
  data.append("upload_preset", UPLOAD_PRESET);
  return fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/${type}/upload`,
    { method: "POST", body: data }).then(r=>r.json());
}

async function uploadMusic(){
  let title = musicTitle.value;
  let tags = musicTags.value;
  let cover = musicCover.files[0];
  let file = musicFile.files[0];

  if(!title || !tags || !cover || !file){
    alert("T√ºm alanlarƒ± doldur");
    return;
  }

  status.innerText = "Y√ºkleniyor...";

  let coverRes = await uploadToCloudinary(cover,"image");
  let musicRes = await uploadToCloudinary(file,"video");

  musics.push({
    title,
    tags,
    cover_url: coverRes.secure_url,
    audio_url: musicRes.secure_url
  });

  await saveMusics();
  renderMusics();
  renderAdminList();
  status.innerText = "Ba≈üarƒ±yla eklendi ‚úÖ";
}

function deleteMusic(i){
  if(confirm("Silmek istediƒüinize emin misiniz?")){
    musics.splice(i,1);
    saveMusics().then(()=>{
      renderMusics();
      renderAdminList();
    });
  }
}

function renderMusics(){
  musicList.innerHTML="";
  const s = search.value.toLowerCase();
  const f = filter.value;

  musics.filter(m =>
    m.title.toLowerCase().includes(s) &&
    (f=="all" || m.tags.includes(f))
  ).forEach((m,i)=>{
    musicList.innerHTML += `
    <div onclick="playMusic(${i})"
    class="bg-card p-3 rounded-xl shadow hover:scale-105 transition cursor-pointer">
    <img src="${m.cover_url}" class="rounded-lg h-48 w-full object-cover mb-2">
    <p class="font-semibold">${m.title}</p>
    <p class="text-sm text-gray-400">${m.tags}</p>
    </div>`
  })
}

function renderAdminList(){
  adminMusicList.innerHTML="";
  musics.forEach((m,i)=>{
    adminMusicList.innerHTML+=`
    <div class="bg-neutral-800 p-2 rounded">
      <img src="${m.cover_url}" class="h-20 mb-2 rounded">
      <p>${m.title}</p>
      <button onclick="deleteMusic(${i})"
      class="bg-red-600 mt-2 px-3 py-1 rounded">Sil</button>
    </div>`
  });
}

function playMusic(i){
  currentIndex=i;
  let m=musics[i];
  player.classList.remove("hidden");
  playerCover.src=m.cover_url;
  playerTitle.innerText=m.title;
  audio.src=m.audio_url;
  downloadBtn.href=m.audio_url;
  audio.play(); playPause.innerText="‚è∏";
}
function togglePlay(){
  if(audio.paused){audio.play();playPause.innerText="‚è∏";}
  else{audio.pause();playPause.innerText="‚ñ∂";}
}
function nextMusic(){if(currentIndex<musics.length-1)playMusic(currentIndex+1);}
function prevMusic(){if(currentIndex>0)playMusic(currentusicIndex-1);}

function openAdminModal(){
  adminModal.classList.remove("hidden");
}
function closeAdminModal(){
  adminModal.classList.add("hidden");
}
function checkAdmin(){
  if(adminPass.value===ADMIN_PASS){
    adminLogin.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    renderAdminList();
  } else alert("Hatalƒ± ≈üifre");
}

loadMusics();
</script>
</body>
</html>
