<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Paneli</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { background-color:#0c0c0c; }
</style>
</head>

<body class="text-white p-6">

<h1 class="text-3xl font-bold">üîê Admin Paneli</h1>

<div id="loginBox" class="mt-6 bg-neutral-900 p-4 rounded-lg max-w-sm">
  <p>≈ûifreyi gir:</p>
  <input id="adminPass" type="password" class="bg-neutral-800 p-2 rounded w-full mt-2">
  <button onclick="login()" class="mt-3 w-full bg-blue-600 p-2 rounded">Giri≈ü Yap</button>
</div>

<div id="panel" class="hidden mt-6">

  <h2 class="text-2xl font-bold mb-4">M√ºzik Y√ºkle</h2>

  <input id="title" placeholder="Ba≈ülƒ±k" class="p-2 bg-neutral-900 rounded w-full mb-2">
  <input id="tags" placeholder="Etiketler" class="p-2 bg-neutral-900 rounded w-full mb-2">
  <label class="block mb-2 text-sm">MP3 Dosyasƒ±:</label>
  <input id="audio" type="file" accept="audio/mp3" class="mb-3">
  <label class="block mb-2 text-sm">Kapak Resmi:</label>
  <input id="cover" type="file" accept="image/*" class="mb-3">

  <button onclick="uploadMusic()" class="bg-green-600 p-2 rounded w-full">Y√ºkle</button>

  <h2 class="text-2xl font-bold mt-8 mb-4">Y√ºkl√º M√ºzikler</h2>
  <div id="adminList" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
</div>

<script>
const PASS = "efe12345efe";

const supabase = supabase.createClient(
  "https://jzidtvylnrolmmlaegyr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6aWR0dnlsbnJvbG1tbGFlZ3lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMDQ4ODgsImV4cCI6MjA4MDU4MDg4OH0.S61VHALTStNxq2RY4B2GhrAuELTtgycsTrTw5cH04EA"
);

function login(){
  const val = document.getElementById("adminPass").value;
  if(val === PASS){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("panel").classList.remove("hidden");
    loadAdminList();
  } else {
    alert("Hatalƒ± ≈üifre!");
  }
}

async function loadAdminList(){
  const { data } = await supabase.from("musics").select("*").order("id",{ascending:false});

  const box = document.getElementById("adminList");
  box.innerHTML = "";

  data.forEach(m=>{
    box.innerHTML += `
      <div class="bg-neutral-900 p-3 rounded-lg">
        <img src="${m.cover_url}" class="h-28 w-full object-cover rounded">
        <p class="mt-2 font-bold">${m.title}</p>
        <p class="text-xs">${m.tags}</p>
        <button onclick="deleteMusic(${m.id})" 
                class="mt-2 bg-red-600 w-full p-1 rounded">Sil</button>
      </div>
    `;
  });
}

async function uploadMusic(){
  const title = document.getElementById("title").value;
  const tags = document.getElementById("tags").value;
  const audio = document.getElementById("audio").files[0];
  const cover = document.getElementById("cover").files[0];

  if(!title || !audio || !cover){ alert("Eksik bilgi!"); return;}

  const audioName = "audio_" + Date.now() + ".mp3";
  const coverName = "cover_" + Date.now() + ".jpg";

  await supabase.storage.from("music").upload(audioName,audio);
  await supabase.storage.from("music").upload(coverName,cover);

  const audioURL = "https://jzidtvylnrolmmlaegyr.supabase.co/storage/v1/object/public/music/" + audioName;
  const coverURL = "https://jzidtvylnrolmmlaegyr.supabase.co/storage/v1/object/public/music/" + coverName;

  await supabase.from("musics").insert({
    title, tags, audio_url: audioURL, cover_url: coverURL
  });

  alert("M√ºzik y√ºklendi!");
  loadAdminList();
}

async function deleteMusic(id){
  await supabase.from("musics").delete().eq("id", id);
  loadAdminList();
}
</script>

</body>
</html>
