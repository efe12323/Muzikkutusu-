<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√ºzik Kutusu</title>
<meta name="description" content="T√ºrkiye‚Äônin %100 √ºcretsiz telifsiz m√ºzik platformu">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* Modern gradient dark theme */
body {
    background: radial-gradient(circle at top, #1a1a1d, #0f0f11 70%);
}

/* Smooth fade animations */
.fade-in { animation: fadeIn .4s ease-out forwards; opacity: 0; }
@keyframes fadeIn { to {opacity:1;} }

/* Hidden admin hot-corner */
#adminHotCorner {
    position: fixed;
    bottom: 0;
    right: 0;
    width: 40px;
    height: 40px;
    opacity: 0;
}
#adminHotCorner:hover { opacity: 0.2; cursor: pointer; }

</style>
</head>

<body class="text-gray-200 select-none">

<!-- HEADER -->
<header class="p-4 text-center text-3xl font-extrabold tracking-wide bg-black/30 backdrop-blur-lg border-b border-gray-700 shadow-lg">
    üéµ M√ºzik Kutusu
</header>

<!-- MUSIC LIST -->
<div id="musicList" class="p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>

<!-- FIXED PLAYER (Initially Hidden) -->
<div id="playerBar" class="hidden fixed bottom-0 left-0 right-0 bg-black/70 backdrop-blur-xl border-t border-gray-700 p-4 flex items-center justify-between">
    <div class="flex items-center gap-4">
        <img id="playerCover" src="" class="w-14 h-14 object-cover rounded hidden shadow-md">
        <div>
            <div id="playerTitle" class="font-bold text-lg"></div>
            <div id="playerTags" class="text-sm text-gray-400"></div>
        </div>
    </div>
    <div class="flex items-center gap-4 text-2xl">
        <button id="prevBtn">‚èÆÔ∏è</button>
        <button id="playPauseBtn">‚ñ∂Ô∏è</button>
        <button id="nextBtn">‚è≠Ô∏è</button>
        <button id="downloadBtn">‚¨áÔ∏è</button>
    </div>
</div>

<!-- Invisible Admin Hot Corner -->
<div id="adminHotCorner" onclick="openAdminLogin()"></div>

<!-- ADMIN LOGIN MODAL -->
<div id="adminLoginModal" class="hidden fixed inset-0 bg-black bg-opacity-70 backdrop-blur-md flex items-center justify-center fade-in">
    <div class="bg-gray-900 p-6 rounded-lg w-80 shadow-xl border border-gray-700">
        <h2 class="text-xl mb-4">üîí Admin Giri≈üi</h2>
        <input id="adminPassword" type="password" placeholder="≈ûifre" class="w-full p-2 bg-gray-800 rounded">
        <button onclick="checkAdmin()" class="mt-4 w-full bg-blue-700 hover:bg-blue-800 p-2 rounded shadow">Giri≈ü Yap</button>
        <button onclick="closeAdminLogin()" class="mt-2 w-full bg-red-700 hover:bg-red-800 p-2 rounded">Kapat</button>
    </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden fixed inset-0 bg-black bg-opacity-80 backdrop-blur-md overflow-auto p-6 fade-in">
    <div class="bg-gray-900 p-6 rounded-xl max-w-2xl mx-auto border border-gray-700 shadow-2xl">
        <h2 class="text-3xl mb-4 text-center font-bold">‚öôÔ∏è Admin Paneli</h2>

        <!-- ADD MUSIC -->
        <div class="bg-gray-800 p-4 rounded-lg mb-6">
            <h3 class="text-xl mb-3 font-semibold">Yeni M√ºzik Ekle</h3>
            <input id="newTitle" placeholder="Ba≈ülƒ±k" class="w-full p-2 bg-gray-700 rounded mb-2">
            <input id="newTags" placeholder="Etiketler" class="w-full p-2 bg-gray-700 rounded mb-2">
            <label class="block mb-2 text-sm">MP3 Dosyasƒ±<input id="newAudio" type="file" accept="audio/mp3" class="mt-1"></label>
            <label class="block mb-2 text-sm">Kapak Resmi<input id="newCover" type="file" accept="image/*" class="mt-1"></label>
            <button onclick="uploadMusic()" class="w-full bg-green-700 hover:bg-green-800 p-2 rounded">Ekle</button>
        </div>

        <!-- MUSIC LIST -->
        <h3 class="text-xl mb-2 font-semibold">Y√ºkl√º M√ºzikler</h3>
        <div id="adminMusicList"></div>

        <button onclick="closeAdminPanel()" class="mt-4 w-full bg-red-700 hover:bg-red-800 p-2 rounded">Kapat</button>
    </div>
</div>

<script>
// SUPABASE CLIENT
const supabase = supabase.createClient(
    "https://jzidtvylnrolmmlaegyr.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6aWR0dnlsbnJvbG1tbGFlZ3lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMDQ4ODgsImV4cCI6MjA4MDU4MDg4OH0.S61VHALTStNxq2RY4B2GhrAuELTtgycsTrTw5cH04EA"
);

let musics = [];
let currentIndex = -1;
let audio = new Audio();

// LOAD MUSIC LIST
async function loadMusics() {
    const { data } = await supabase.from("musics").select("*").order("created_at", { ascending: false });
    musics = data || [];
    renderMusicList();
}
loadMusics();

// RENDER LIST
function renderMusicList() {
    const list = document.getElementById("musicList");
    list.innerHTML = "";

    musics.forEach((m, i) => {
        list.innerHTML += `
            <div class="bg-gray-800 hover:bg-gray-700 transition p-4 rounded-xl cursor-pointer shadow-xl" onclick="playMusic(${i})">
                <img src="${m.cover_url}" class="w-full h-48 object-cover rounded-lg shadow mb-3">
                <div class="font-bold text-lg">${m.title}</div>
                <div class="text-gray-400 text-sm">${m.tags}</div>
            </div>
        `;
    });
}

// PLAYER
function playMusic(i) {
    currentIndex = i;
    const m = musics[i];

    document.getElementById("playerBar").classList.remove("hidden");
    document.getElementById("playerCover").src = m.cover_url;
    document.getElementById("playerCover").classList.remove("hidden");

    playerTitle.innerText = m.title;
    playerTags.innerText = m.tags;

    audio.src = m.audio_url;
    audio.play();
    playPauseBtn.innerText = "‚è∏Ô∏è";
}

playPauseBtn.onclick = () => {
    if (audio.paused) { audio.play(); playPauseBtn.innerText = "‚è∏Ô∏è"; }
    else { audio.pause(); playPauseBtn.innerText = "‚ñ∂Ô∏è"; }
};

nextBtn.onclick = () => {
    if (currentIndex < musics.length - 1) playMusic(currentIndex + 1);
};
prevBtn.onclick = () => {
    if (currentIndex > 0) playMusic(currentIndex - 1);
};

downloadBtn.onclick = () => {
    if (currentIndex < 0) return;
    const url = musics[currentIndex].audio_url;
    const a = document.createElement("a");
    a.href = url;
    a.download = url.split("/").pop();
    a.click();
};

// ADMIN LOGIN
function openAdminLogin() {
    adminLoginModal.classList.remove("hidden");
}
function closeAdminLogin() {
    adminLoginModal.classList.add("hidden");
}
function checkAdmin() {
    if (adminPassword.value === "efe12345efe") {
        adminLoginModal.classList.add("hidden");
        adminPanel.classList.remove("hidden");
        loadAdminList();
    } else alert("Hatalƒ± ≈üifre!");
}

// ADMIN PANEL
function closeAdminPanel() {
    adminPanel.classList.add("hidden");
}

async function uploadMusic() {
    const title = newTitle.value;
    const tags = newTags.value;
    const audioFile = newAudio.files[0];
    const coverFile = newCover.files[0];

    if (!title || !audioFile || !coverFile) return alert("L√ºtfen t√ºm alanlarƒ± doldurun!");

    const audioPath = Date.now() + "_" + audioFile.name;
    const coverPath = Date.now() + "_" + coverFile.name;

    await supabase.storage.from("music").upload(audioPath, audioFile, { upsert: true });
    await supabase.storage.from("music").upload(coverPath, coverFile, { upsert: true });

    const audioURL = supabase.storage.from("music").getPublicUrl(audioPath).data.publicUrl;
    const coverURL = supabase.storage.from("music").getPublicUrl(coverPath).data.publicUrl;

    await supabase.from("musics").insert([{ title, tags, audio_url: audioURL, cover_url: coverURL }]);

    loadMusics();
    loadAdminList();
    alert("M√ºzik eklendi!");
}

async function loadAdminList() {
    const { data } = await supabase.from("musics").select("*").order("created_at", { ascending: false });
    const list = document.getElementById("adminMusicList");
    list.innerHTML = "";

    data.forEach(m => {
        list.innerHTML += `
            <div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg mb-2 shadow">
                <div>${m.title}</div>
                <button class="bg-red-700 hover:bg-red-800 px-3 py-1 rounded" onclick="deleteMusic('${m.id}')">Sil</button>
            </div>
        `;
    });
}

async function deleteMusic(id) {
    await supabase.from("musics").delete().eq("id", id);
    loadMusics();
    loadAdminList();
}
</script>
</body>
</html>
